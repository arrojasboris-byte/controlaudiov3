<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Control Center Audio - Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Fuente y estilos b√°sicos -->
  <style>
    :root {
      --bg: #050816;
      --bg-sidebar: #020617;
      --bg-card: #0f172a;
      --bg-card-soft: #111827;
      --accent: #ef4444;
      --accent-soft: #fecaca;
      --accent-warn: #f97316;
      --accent-danger: #ef4444;
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --border-soft: #1f2937;
      --radius-lg: 14px;
      --radius-xl: 18px;
      --shadow-soft: 0 14px 30px rgba(0,0,0,.45);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
    }

    body {
      background: radial-gradient(circle at top left, #1f2937, #020617 45%);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
    }

    body.light-theme {
      --bg: #f3f4f6;
      --bg-sidebar: #000000;
      --bg-card: #ffffff;
      --bg-card-soft: #e5e7eb;
      --text-main: #111827;
      --text-muted: #6b7280;
      --border-soft: #d1d5db;
      background: #f3f4f6;
      color: var(--text-main);
    }

    /* Layout principal */
    .sidebar {
      width: 250px;
      background: linear-gradient(180deg, var(--bg-sidebar), var(--bg-sidebar) 40%, var(--bg-sidebar));
      border-right: 1px solid var(--border-soft);
      padding: 18px 18px 24px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-badge {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #facc15, #ef4444);
      box-shadow: 0 0 15px rgba(239,68,68,.5);
    }

    .logo-text {
      display: flex;
      flex-direction: column;
    }

    .logo-title {
      font-weight: 700;
      font-size: 1.05rem;
    }

    .logo-subtitle {
      font-size: .7rem;
      color: var(--text-muted);
    }

    .sidebar-footer {
      margin-top: auto;
      font-size: .78rem;
      color: var(--text-muted);
    }

    /* Contenido principal */
    .main {
      flex: 1;
      padding: 18px 22px 26px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .topbar {
      display: flex;
      align-items: center;
      gap: 14px;
      justify-content: flex-end;
    }

    .btn {
      border-radius: 999px;
      padding: 8px 14px;
      border: 1px solid transparent;
      font-size: .8rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #0f172a;
      color: var(--text-main);
    }

    .btn-cta {
      background: linear-gradient(90deg, var(--accent), #f97373);
      color: #111827;
      font-weight: 600;
      box-shadow: 0 10px 25px rgba(239,68,68,.35);
    }

    .btn-outline {
      border-color: var(--border-soft);
      background: transparent;
    }

    body.light-theme .btn-outline {
      background: #ffffff;
    }

    .btn span.icon {
      font-size: .85rem;
    }

    .filters-row {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      font-size: .8rem;
    }

    .select {
      background: rgba(15,23,42,.95);
      border-radius: 999px;
      padding: 6px 12px;
      border: 1px solid var(--border-soft);
      color: var(--text-main);
      outline: none;
      font-size: .8rem;
    }

    body.light-theme .select {
      background: #ffffff;
      color: #111827;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
    }

    .section-header h2 {
      font-size: 1.08rem;
      font-weight: 600;
    }

    .section-header span.sub {
      font-size: .78rem;
      color: var(--text-muted);
    }

    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
    }

    .card {
      background: radial-gradient(circle at top left, var(--bg-card-soft), #020617 55%);
      border-radius: var(--radius-xl);
      padding: 14px 14px 12px;
      border: 1px solid rgba(15,23,42,.9);
      box-shadow: var(--shadow-soft);
    }

    body.light-theme .card {
      background: #ffffff;
      border-color: #e5e7eb;
      box-shadow: 0 10px 25px rgba(15,23,42,.12);
    }

    .card-header {
      font-size: .8rem;
      color: var(--text-muted);
      margin-bottom: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .kpi-main {
      font-size: 1.4rem;
      font-weight: 700;
      display: flex;
      align-items: baseline;
      gap: 6px;
    }

    .kpi-tag {
      font-size: .72rem;
      border-radius: 999px;
      padding: 3px 8px;
      background: rgba(239,68,68,.12);
      color: #fecaca;
    }

    body.light-theme .kpi-tag {
      color: #b91c1c;
    }

    .kpi-tag.warn {
      background: rgba(234,179,8,.12);
      color: #facc15;
    }

    .kpi-secondary {
      font-size: .76rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* Grid central: 4 gr√°ficos */
    .grid-main {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.4fr);
      gap: 16px;
      align-items: stretch;
    }

    .card h3 {
      font-size: .9rem;
      margin-bottom: 8px;
    }

    .card-sub {
      font-size: .76rem;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .chart-container {
      position: relative;
      height: 230px;
      width: 100%;
    }

    .chart-container.tall {
      height: 260px;
    }

    /* Toasts */
    .toast {
      position: fixed;
      right: 18px;
      bottom: 18px;
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(15,23,42,.95);
      border: 1px solid rgba(148,163,184,.6);
      font-size: .8rem;
      color: var(--text-main);
      box-shadow: 0 10px 30px rgba(0,0,0,.5);
      opacity: 1;
      transition: opacity .3s ease, transform .3s ease;
      transform: translateY(0);
      z-index: 9999;
    }

    .toast.hide {
      opacity: 0;
      transform: translateY(6px);
    }

    /* Responsivo */
    @media (max-width: 960px) {
      .sidebar {
        display: none;
      }
      body {
        display: block;
      }
      .main {
        padding: 14px;
      }
      .grid-main {
        grid-template-columns: 1fr;
      }
    }
  </style>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <!-- SIDEBAR (FALD√ìN IZQUIERDO) -->
  <aside class="sidebar">
    <div class="logo">
      <div class="logo-badge"></div>
      <div class="logo-text">
        <span class="logo-title">Control Center Audio</span>
        <span class="logo-subtitle">Dashboard de procesos y KPIs</span>
      </div>
    </div>

    <div class="sidebar-footer">
      <p>Versi√≥n demo ¬∑ Datos ficticios</p>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <!-- Topbar -->
    <div class="topbar">
      <button class="btn btn-outline" id="btnToggleTheme">
        <span class="icon">‚òÄÔ∏è</span> Modo claro
      </button>
      <button class="btn btn-outline" id="btnSaveView">
        <span class="icon">üíæ</span> Guardar vista
      </button>
      <button class="btn btn-outline" id="btnExportHtml">
        <span class="icon">‚¨áÔ∏è</span> Exportar HTML
      </button>
      <button class="btn btn-cta" id="btnSyncCloud">
        <span class="icon">‚òÅÔ∏è</span> Actualizar datos nube
      </button>
    </div>

    <!-- Filtros -->
    <div class="filters-row">
      <select class="select" id="selectPeriodo">
        <option value="12">Periodo: √öltimos 12 meses</option>
        <option value="3">√öltimos 3 meses</option>
        <option value="1">√öltimo mes</option>
      </select>
      <select class="select" id="selectTipoCentro">
        <option value="todos">Tipo centro: Todos</option>
        <option value="propio">Centro propio</option>
        <option value="franquicia">Franquicia</option>
      </select>
    </div>

    <!-- Resumen general -->
    <div>
      <div class="section-header">
        <h2>Resumen general KPIs</h2>
        <span class="sub" id="resumenSub">
          Visi√≥n r√°pida de procesos, HIT, primeros auxilios, conversiones y formaciones
        </span>
      </div>
    </div>

    <!-- KPIs (Procesos, HIT, Primeros auxilios, Conv. prueba, Conv. venta, Formaciones) -->
    <section class="kpi-grid">
      <article class="card">
        <div class="card-header">
          <span>Procesos aplicados</span>
        </div>
        <div class="kpi-main">
          <span id="kpiProcesos">84%</span>
          <span class="kpi-tag">Objetivo 90%</span>
        </div>
        <div class="kpi-secondary">
          +3 pts vs periodo anterior
        </div>
      </article>

      <article class="card">
        <div class="card-header">
          <span>HIT (global)</span>
        </div>
        <div class="kpi-main">
          <span id="kpiHit">81%</span>
          <span class="kpi-tag">Objetivo 88%</span>
        </div>
        <div class="kpi-secondary">
          En mejora en 2 de 6 regiones
        </div>
      </article>

      <article class="card">
        <div class="card-header">
          <span>Primeros auxilios</span>
        </div>
        <div class="kpi-main">
          <span id="kpiPrimerosAuxilios">63%</span>
          <span class="kpi-tag warn">Cobertura insuficiente</span>
        </div>
        <div class="kpi-secondary">
          4 centros sin protocolo actualizado
        </div>
      </article>

      <article class="card">
        <div class="card-header">
          <span>Conversi√≥n a prueba</span>
        </div>
        <div class="kpi-main">
          <span id="kpiConvPrueba">39%</span>
          <span class="kpi-tag">+5 pts crecimiento</span>
        </div>
        <div class="kpi-secondary">
          Ratio sobre visitas cualificadas
        </div>
      </article>

      <article class="card">
        <div class="card-header">
          <span>Conversi√≥n a venta</span>
        </div>
        <div class="kpi-main">
          <span id="kpiConvVenta">27%</span>
          <span class="kpi-tag warn">Potencial seguimiento</span>
        </div>
        <div class="kpi-secondary">
          Ticket medio: 1.430 ‚Ç¨ ¬∑ Devoluciones 3,2%
        </div>
      </article>

      <article class="card">
        <div class="card-header">
          <span>Formaciones realizadas</span>
        </div>
        <div class="kpi-main">
          <span id="kpiFormaciones">18</span>
          <span class="kpi-tag">Plan 24 / a√±o</span>
        </div>
        <div class="kpi-secondary">
          6 pendientes de planificar ¬∑ Foco en procesos y primeros auxilios
        </div>
      </article>
    </section>

    <!-- 4 GR√ÅFICAS DEL DASHBOARD -->
    <section class="grid-main">
      <!-- 1. Evoluci√≥n mensual (barras + curvas: Procesos, HIT, Conv. prueba, Conv. venta) -->
      <article class="card">
        <h3>Evoluci√≥n mensual de procesos y resultados</h3>
        <p class="card-sub">
          Barras de % procesos aplicados y curvas de HIT, conversi√≥n a prueba y conversi√≥n a venta
        </p>
        <div class="chart-container">
          <canvas id="chartEvolucion"></canvas>
        </div>
      </article>

      <!-- 2. Estado de visitas -->
      <article class="card">
        <h3>Estado de visitas</h3>
        <p class="card-sub">
          Distribuci√≥n de visitas realizadas, pendientes y anuladas
        </p>
        <div class="chart-container">
          <canvas id="chartVisitas"></canvas>
        </div>
      </article>

      <!-- 3. √Årea de mejora de procesos -->
      <article class="card">
        <h3>√Årea de mejora de procesos</h3>
        <p class="card-sub">
          Top 10 criterios con mayor porcentaje de procesos no aplicados
        </p>
        <div class="chart-container tall">
          <canvas id="chartAreaMejora"></canvas>
        </div>
      </article>

      <!-- 4. Ranking por delegados (√≠ndice global promedio por regi√≥n) -->
      <article class="card">
        <h3>Ranking por delegados ¬∑ √≠ndice global</h3>
        <p class="card-sub">
          √çndice global (promedio de todos sus centros evaluados) ¬∑ se muestran solo los 5 primeros delegados
        </p>
        <div class="chart-container tall">
          <canvas id="chartDelegados"></canvas>
        </div>
      </article>
    </section>
  </main>

  <script>
    // ------- GR√ÅFICOS DEMO (Chart.js) --------

    // 1. Evoluci√≥n mensual: barras + l√≠neas (Procesos, HIT, Conv. prueba, Conv. venta)
    const ctxEvo = document.getElementById('chartEvolucion').getContext('2d');
    const chartEvolucion = new Chart(ctxEvo, {
      type: 'bar',
      data: {
        labels: ['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'],
        datasets: [
          {
            type: 'bar',
            label: '% Procesos aplicados',
            data: [78, 80, 81, 82, 83, 84, 85, 86, 87, 88, 87, 88],
            backgroundColor: 'rgba(239,68,68,0.7)',
            borderRadius: 6
          },
          {
            type: 'line',
            label: '% HIT',
            data: [76, 77, 78, 79, 80, 81, 82, 83, 84, 83, 82, 82],
            borderColor: '#38bdf8',
            borderWidth: 2,
            tension: 0.35,
            fill: false,
            pointRadius: 2
          },
          {
            type: 'line',
            label: '% Conversi√≥n a prueba',
            data: [32, 33, 34, 35, 36, 37, 38, 39, 40, 40, 39, 40],
            borderColor: '#a855f7',
            borderWidth: 2,
            tension: 0.35,
            fill: false,
            pointRadius: 2
          },
          {
            type: 'line',
            label: '% Conversi√≥n a venta',
            data: [21, 22, 23, 24, 25, 26, 27, 27, 28, 27, 26, 27],
            borderColor: '#f97316',
            borderWidth: 2,
            tension: 0.35,
            fill: false,
            pointRadius: 2
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: {
              color: '#e5e7eb',
              font: { size: 11 }
            }
          }
        },
        scales: {
          x: {
            ticks: { color: '#9ca3af', font: { size: 10 } },
            grid: { color: 'rgba(31,41,55,0.35)' }
          },
          y: {
            ticks: {
              color: '#9ca3af',
              font: { size: 10 },
              callback: value => value + '%'
            },
            grid: { color: 'rgba(31,41,55,0.35)' }
          }
        }
      }
    });

    // 2. Donut estado de visitas
    const ctxVis = document.getElementById('chartVisitas').getContext('2d');
    const chartVisitas = new Chart(ctxVis, {
      type: 'doughnut',
      data: {
        labels: ['Realizadas', 'Pendientes', 'Anuladas'],
        datasets: [{
          data: [72, 19, 9],
          borderWidth: 0,
          backgroundColor: [
            'rgba(239,68,68,0.9)',   // Realizadas (rojo)
            'rgba(249,115,22,0.9)',  // Pendientes (naranja)
            'rgba(148,163,184,0.9)'  // Anuladas (gris)
          ]
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              color: '#e5e7eb',
              font: { size: 11 }
            }
          }
        },
        cutout: '65%'
      }
    });

    // 3. √Årea de mejora de procesos (Top 10 criterios no aplicados)
    const ctxArea = document.getElementById('chartAreaMejora').getContext('2d');
    const chartAreaMejora = new Chart(ctxArea, {
      type: 'bar',
      data: {
        labels: [
          'Seguimiento a 7 d√≠as',
          'Entrega folleto HIT',
          'Simulaci√≥n financiaci√≥n',
          'Registro motivo no venta',
          'Uso guion ACE',
          'Teleaudiometr√≠a',
          'Derivaci√≥n ORL',
          'Plan fidelizaci√≥n',
          'Registro competidor',
          'Revisi√≥n preventiva'
        ],
        datasets: [{
          label: '% procesos no aplicados',
          data: [38, 34, 31, 29, 27, 25, 22, 20, 18, 15],
          backgroundColor: 'rgba(239,68,68,0.9)',
          borderRadius: 6
        }]
      },
      options: {
        indexAxis: 'y',
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: {
              color: '#e5e7eb',
              font: { size: 11 }
            }
          },
          tooltip: {
            callbacks: {
              label: ctx => ctx.parsed.x + '% no aplicado'
            }
          }
        },
        scales: {
          x: {
            ticks: {
              color: '#9ca3af',
              font: { size: 10 },
              callback: value => value + '%'
            },
            grid: { color: 'rgba(31,41,55,0.35)' }
          },
          y: {
            ticks: { color: '#9ca3af', font: { size: 10 } },
            grid: { display: false }
          }
        }
      }
    });

    // 4. Ranking por delegados (√≠ndice global, top 5, barras con color diferente)
    const ctxDel = document.getElementById('chartDelegados').getContext('2d');
    const labelsDelegados = ['Blanca', 'Cecilia', 'Daniel', 'Eneritz', 'Luis']; // top 5
    const dataIndiceGlobal = [87, 92, 80, 85, 77]; // promedio de todos sus centros evaluados

    const chartDelegados = new Chart(ctxDel, {
      type: 'bar',
      data: {
        labels: labelsDelegados,
        datasets: [
          {
            label: '√çndice global delegado',
            data: dataIndiceGlobal,
            backgroundColor: [
              'rgba(239,68,68,0.9)',
              'rgba(59,130,246,0.9)',
              'rgba(168,85,247,0.9)',
              'rgba(249,115,22,0.9)',
              'rgba(234,179,8,0.9)'
            ],
            borderRadius: 5
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: {
              color: '#e5e7eb',
              font: { size: 11 }
            }
          },
          tooltip: {
            callbacks: {
              label: ctx => ctx.parsed.y + ' ¬∑ √≠ndice global'
            }
          }
        },
        scales: {
          x: {
            ticks: { color: '#9ca3af', font: { size: 10 } },
            grid: { color: 'rgba(31,41,55,0.35)' }
          },
          y: {
            ticks: {
              color: '#9ca3af',
              font: { size: 10 }
            },
            grid: { color: 'rgba(31,41,55,0.35)' },
            suggestedMin: 60,
            suggestedMax: 100
          }
        }
      }
    });

    // ------- L√ìGICA INTERACTIVA EXTRA --------

    // Helper toast
    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.classList.add('hide');
        setTimeout(() => toast.remove(), 300);
      }, 1800);
    }

    const btnSaveView = document.getElementById('btnSaveView');
    const btnExportHtml = document.getElementById('btnExportHtml');
    const btnSyncCloud = document.getElementById('btnSyncCloud');
    const btnToggleTheme = document.getElementById('btnToggleTheme');
    const selectPeriodo = document.getElementById('selectPeriodo');
    const selectTipoCentro = document.getElementById('selectTipoCentro');
    const resumenSub = document.getElementById('resumenSub');

    const CONFIG_KEY = 'ccAudioConfig';

    function actualizarTextoResumen() {
      let periodoTexto = '';
      switch (selectPeriodo.value) {
        case '12':
          periodoTexto = '√∫ltimos 12 meses';
          break;
        case '3':
          periodoTexto = '√∫ltimos 3 meses';
          break;
        case '1':
          periodoTexto = '√∫ltimo mes';
          break;
      }

      let tipoTexto = '';
      switch (selectTipoCentro.value) {
        case 'todos':
          tipoTexto = 'todos los tipos de centro';
          break;
        case 'propio':
          tipoTexto = 'centros propios';
          break;
        case 'franquicia':
          tipoTexto = 'franquicias';
          break;
      }

      resumenSub.textContent =
        'Visi√≥n r√°pida de procesos, HIT, primeros auxilios, conversiones y formaciones ¬∑ ' +
        periodoTexto + ' ¬∑ ' + tipoTexto + ' (datos demo)';
    }

    function applyTheme(theme) {
      if (theme === 'light') {
        document.body.classList.add('light-theme');
        btnToggleTheme.innerHTML = '<span class="icon">üåô</span> Modo oscuro';
      } else {
        document.body.classList.remove('light-theme');
        btnToggleTheme.innerHTML = '<span class="icon">‚òÄÔ∏è</span> Modo claro';
      }
    }

    function saveConfig() {
      const cfg = {
        theme: document.body.classList.contains('light-theme') ? 'light' : 'dark',
        periodo: selectPeriodo.value,
        tipoCentro: selectTipoCentro.value
      };
      try {
        localStorage.setItem(CONFIG_KEY, JSON.stringify(cfg));
      } catch (e) {
        console.warn('No se pudo guardar la configuraci√≥n', e);
      }
    }

    function loadConfig() {
      let cfg = null;
      try {
        const raw = localStorage.getItem(CONFIG_KEY);
        if (raw) {
          cfg = JSON.parse(raw);
        }
      } catch (e) {
        console.warn('No se pudo leer la configuraci√≥n', e);
      }

      if (cfg) {
        if (cfg.theme) applyTheme(cfg.theme);
        if (cfg.periodo) selectPeriodo.value = cfg.periodo;
        if (cfg.tipoCentro) selectTipoCentro.value = cfg.tipoCentro;
      } else {
        applyTheme('dark');
      }

      actualizarTextoResumen();
    }

    // Bot√≥n tema claro/oscuro
    btnToggleTheme.addEventListener('click', () => {
      const isLight = !document.body.classList.contains('light-theme');
      applyTheme(isLight ? 'light' : 'dark');
      saveConfig();
    });

    // Bot√≥n Guardar vista (tema + filtros)
    btnSaveView.addEventListener('click', () => {
      saveConfig();
      showToast('Preferencias guardadas en este navegador');
    });

    // Bot√≥n Exportar HTML
    btnExportHtml.addEventListener('click', () => {
      try {
        const htmlCompleto = '<!DOCTYPE html>\n' + document.documentElement.outerHTML;
        const blob = new Blob([htmlCompleto], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'control-center-audio-dashboard.html';
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
        showToast('HTML exportado (descarga iniciada)');
      } catch (e) {
        console.error('Error exportando HTML', e);
        showToast('No se pudo exportar el HTML');
      }
    });

    // Bot√≥n Actualizar nube (demo)
    btnSyncCloud.addEventListener('click', () => {
      showToast('Sincronizaci√≥n con la nube simulada (demo)');
    });

    // Cambios de filtros
    selectPeriodo.addEventListener('change', () => {
      actualizarTextoResumen();
      saveConfig();
    });

    selectTipoCentro.addEventListener('change', () => {
      actualizarTextoResumen();
      saveConfig();
    });

    // Init
    loadConfig();
  </script>
</body>
</html>
